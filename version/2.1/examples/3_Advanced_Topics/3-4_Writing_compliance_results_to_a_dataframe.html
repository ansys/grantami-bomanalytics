
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Write compliance results to a pandas.DataFrame object &#8212; PyGranta BoM Analytics 2.1.1</title>

  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/ansys_sphinx_theme.css?v=4f651e51" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/dataframe.css?v=1a040689" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>
 
<link href="../../_static/css/breadcrumbs.css" rel="stylesheet" />

    <script src="../../_static/documentation_options.js?v=b47a612a"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=49e1bf35"></script>
    <script src="../../_static/js/table.js?v=b64f5182"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/3_Advanced_Topics/3-4_Writing_compliance_results_to_a_dataframe';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.14.3';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://bomanalytics.grantami.docs.pyansys.com/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '2.1';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="../../_static/js/add_blank.js?v=f2ece54a"></script>
    <link rel="icon" href="../../_static/ansys-favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Creating a Bill of Materials from an external data source" href="3-5_Creating_a_Bill_of_Materials.html" />
    <link rel="prev" title="Database-specific configuration options" href="3-3_Database-specific_configuration.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <link rel="canonical" href="https://bomanalytics.grantami.docs.pyansys.com/version/stable/examples/3_Advanced_Topics/3-4_Writing_compliance_results_to_a_dataframe.html" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container"><!-- Debugging: html_theme_options =  -->

<!-- If there is no MiliSearch enabled, use the PyData search -->
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
   
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/pyansys-logo-black-cropped.png" class="logo__image only-light" alt="PyGranta BoM Analytics 2.1.1 - Home"/>
    <script>document.write(`<img src="../../_static/pyansys-logo-black-cropped.png" class="logo__image only-dark" alt="PyGranta BoM Analytics 2.1.1 - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../contributing.html">
                        Contribute
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/grantami-bomanalytics" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
    <div id="announcement_msg"></div>
<script>
  fetch("announcement.html")
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error: ${response.status}`);
      }
      return response.text();
    })
    .then(
      (text) => (document.getElementById("announcement_msg").innerHTML = text),
    )
    .catch((error) => console.error(`Fetch problem: ${error.message}`));
</script>  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../contributing.html">
                        Contribute
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/grantami-bomanalytics" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../0_Getting_started.html">Basic usage example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_Impacted_Substances_Queries/index.html">Impacted substances examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_Compliance_Queries/index.html">Compliance Examples</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Advanced examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="3-1_Working_with_XML_BoMs.html">Perform a BoM query</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-2_Dealing_with_external_data_sources.html">Determine compliance for BoMs in external data sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-3_Database-specific_configuration.html">Database-specific configuration options</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Write compliance results to a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-5_Creating_a_Bill_of_Materials.html">Creating a Bill of Materials from an external data source</a></li>

</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../4_Sustainability/index.html">Sustainability</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">
<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
         
    <li class="breadcrumb-item breadcrumb-home">
      <a href="https://docs.pyansys.com/" class="nav-link">PyAnsys Documentation</a>
    </li>
       
    <li class="breadcrumb-item">
      <a href="https://grantami.docs.pyansys.com/" class="nav-link">PyGranta</a>
    </li>
     
    <li class="breadcrumb-item">
      <a
        href="../../index.html"
        class="nav-link"
        aria-label="Home"
      >
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
     
    <li class="breadcrumb-item">
      <a href="../index.html" class="nav-link">Examples</a>
    </li>
     
    <li class="breadcrumb-item">
      <a href="index.html" class="nav-link">Advanced examples</a>
    </li>
      
    <li class="breadcrumb-item active" aria-current="page">Write compliance results to a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object</li>
    
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p>Download this example as a <a class="reference download internal" download="" href="../../_downloads/b6b3a6c6f94b0131fe26d731bf07d3d0/3-4_Writing_compliance_results_to_a_dataframe.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Jupyter</span> <span class="pre">notebook</span></code></a> or a
<a class="reference download internal" download="" href="../../_downloads/694a152d0cc493ac22496288315de234/3-4_Writing_compliance_results_to_a_dataframe.py"><code class="xref download docutils literal notranslate"><span class="pre">Python</span> <span class="pre">script</span></code></a>.</p>
<hr class="docutils" />
<section id="Write-compliance-results-to-a-pandas.DataFrame-object">
<h1>Write compliance results to a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object<a class="headerlink" href="#Write-compliance-results-to-a-pandas.DataFrame-object" title="Link to this heading">#</a></h1>
<p>Granta MI BoM Analytics presents compliance results in a hierarchical data structure. Alternatively, you can represent the data in a tabular data structure, where each row contains a reference to the parent row. This example shows how compliance data can be translated from one format to another, making use of a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object to store the tabulated data.</p>
<section id="Perform-a-compliance-query">
<h2>Perform a compliance query<a class="headerlink" href="#Perform-a-compliance-query" title="Link to this heading">#</a></h2>
<p>The first step is to perform a compliance query on an assembly that results in a deeply nested structure. The following code is presented without explanation. For more information, see the <a class="reference internal" href="../2_Compliance_Queries/2-3_Part_compliance.html"><span class="doc">Perform a Part Compliance Query</span></a> example.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansys.grantami.bomanalytics</span> <span class="kn">import</span> <span class="n">Connection</span><span class="p">,</span> <span class="n">indicators</span><span class="p">,</span> <span class="n">queries</span>

<span class="n">server_url</span> <span class="o">=</span> <span class="s2">&quot;http://my_grantami_server/mi_servicelayer&quot;</span>
<span class="n">cxn</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">(</span><span class="n">server_url</span><span class="p">)</span><span class="o">.</span><span class="n">with_credentials</span><span class="p">(</span><span class="s2">&quot;user_name&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">svhc</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">WatchListIndicator</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;SVHC&quot;</span><span class="p">,</span>
    <span class="n">legislation_ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Candidate_AnnexXV&quot;</span><span class="p">],</span>
    <span class="n">default_threshold_percentage</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">part_query</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">queries</span><span class="o">.</span><span class="n">PartComplianceQuery</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_record_history_ids</span><span class="p">([</span><span class="mi">565060</span><span class="p">])</span>
    <span class="o">.</span><span class="n">with_indicators</span><span class="p">([</span><span class="n">svhc</span><span class="p">])</span>
<span class="p">)</span>
<span class="n">part_result</span> <span class="o">=</span> <span class="n">cxn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">part_query</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">part_result</span></code> object contains the compliance result for every subitem. This is ideal for understanding compliance at a certain <em>level</em> of the structure, For example, you can display the compliance for each item directly under the root part.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">part_result</span><span class="o">.</span><span class="n">compliance_by_part_and_indicator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Part ID: </span><span class="si">{</span><span class="n">part</span><span class="o">.</span><span class="n">record_history_identity</span><span class="si">}</span><span class="s2">, &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Compliance: </span><span class="si">{</span><span class="n">part</span><span class="o">.</span><span class="n">indicators</span><span class="p">[</span><span class="s1">&#39;SVHC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flag</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Part ID: None, Compliance: WatchListFlag.WatchListCompliant
Part ID: None, Compliance: WatchListFlag.WatchListCompliant
Part ID: None, Compliance: WatchListFlag.WatchListCompliant
Part ID: None, Compliance: WatchListFlag.WatchListCompliant
Part ID: None, Compliance: WatchListFlag.WatchListCompliant
Part ID: None, Compliance: WatchListFlag.WatchListCompliant
Part ID: None, Compliance: WatchListFlag.WatchListCompliant
Part ID: None, Compliance: WatchListFlag.WatchListCompliant
Part ID: None, Compliance: WatchListFlag.WatchListCompliant
Part ID: None, Compliance: WatchListFlag.WatchListCompliant
Part ID: None, Compliance: WatchListFlag.WatchListCompliant
Part ID: None, Compliance: WatchListFlag.WatchListHasSubstanceAboveThreshold
</pre></div></div>
</div>
<p>However, this structure makes it difficult to compare items at different levels. To do that, you want to flatten the data into a tabular structure.</p>
</section>
<section id="Flatten-the-hierarchical-data-structure">
<h2>Flatten the hierarchical data structure<a class="headerlink" href="#Flatten-the-hierarchical-data-structure" title="Link to this heading">#</a></h2>
<p>You want to flatten the data into a <code class="docutils literal notranslate"><span class="pre">list</span></code> of <code class="docutils literal notranslate"><span class="pre">dict</span></code> objects, where each <code class="docutils literal notranslate"><span class="pre">dict</span></code> object represents an item in the hierarchy and each value in the <code class="docutils literal notranslate"><span class="pre">dict</span></code> object represents a property of this item. You can this use this structure can then directly or use it to construct a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object.</p>
<p>First, define a helper function to transform a <code class="docutils literal notranslate"><span class="pre">ComplianceQueryResult</span></code> object into a <code class="docutils literal notranslate"><span class="pre">dict</span></code> object. In addition to storing properties that are intrinsic to the item (such as the ID, type, and SVHC result), you want to store structural information, such as the level of the item and the ID of its parent.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">item_type</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a BoM item to a list&quot;&quot;&quot;</span>
    <span class="n">item_id</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">record_history_identity</span>
    <span class="n">indicator</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">indicators</span><span class="p">[</span><span class="s2">&quot;SVHC&quot;</span><span class="p">]</span>
    <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Item&quot;</span><span class="p">:</span> <span class="n">item_id</span><span class="p">,</span>
        <span class="s2">&quot;Parent&quot;</span><span class="p">:</span> <span class="n">parent_id</span><span class="p">,</span>
        <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="n">item_type</span><span class="p">,</span>
        <span class="s2">&quot;SVHC&quot;</span><span class="p">:</span> <span class="n">indicator</span><span class="p">,</span>
        <span class="s2">&quot;Level&quot;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">row</span>
</pre></div>
</div>
</div>
<p>To help with the flattening process, you also define a schema, which describes which child item types each item type can contain.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Part&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Part&quot;</span><span class="p">,</span> <span class="s2">&quot;Specification&quot;</span><span class="p">,</span> <span class="s2">&quot;Material&quot;</span><span class="p">,</span> <span class="s2">&quot;Substance&quot;</span><span class="p">],</span>
    <span class="s2">&quot;Specification&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Specification&quot;</span><span class="p">,</span> <span class="s2">&quot;Coating&quot;</span><span class="p">,</span> <span class="s2">&quot;Material&quot;</span><span class="p">,</span> <span class="s2">&quot;Substance&quot;</span><span class="p">],</span>
    <span class="s2">&quot;Material&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Substance&quot;</span><span class="p">],</span>
    <span class="s2">&quot;Coating&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Substance&quot;</span><span class="p">],</span>
    <span class="s2">&quot;Substance&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>The function itself performs the flattening via a stack-based approach, where the children of the item currently being processed are iteratively added to the <code class="docutils literal notranslate"><span class="pre">items_to_process</span></code> stack. Because this stack is being both modified and iterated over, you must use a <code class="docutils literal notranslate"><span class="pre">while</span></code> loop and <code class="docutils literal notranslate"><span class="pre">.pop()</span></code> statement instead of a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop.</p>
<p>The stack uses a special type of collection called a <code class="docutils literal notranslate"><span class="pre">deque</span></code>, which is similar to a <code class="docutils literal notranslate"><span class="pre">list</span></code> but is optimized for these sorts of stack-type use cases involving repeated calls to <code class="docutils literal notranslate"><span class="pre">.pop()</span></code> and <code class="docutils literal notranslate"><span class="pre">.extend()</span></code> statements.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>


<span class="k">def</span> <span class="nf">flatten_bom</span><span class="p">(</span><span class="n">root_part</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># List to contain all dicts</span>

    <span class="c1"># The stack contains a deque of tuples: (item_object, item_type, level, parent_id)</span>
    <span class="c1"># First seed the stack with the root part</span>
    <span class="n">items_to_process</span> <span class="o">=</span> <span class="n">deque</span><span class="p">([(</span><span class="n">root_part</span><span class="p">,</span> <span class="s2">&quot;Part&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)])</span>

    <span class="k">while</span> <span class="n">items_to_process</span><span class="p">:</span>
        <span class="c1"># Get the next item from the stack</span>
        <span class="n">item_object</span><span class="p">,</span> <span class="n">item_type</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="n">items_to_process</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="c1"># Create the dict</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">create_dict</span><span class="p">(</span><span class="n">item_object</span><span class="p">,</span> <span class="n">item_type</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="c1"># Append it to the result list</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="c1"># Compute the properties for the child items</span>
        <span class="n">item_id</span> <span class="o">=</span> <span class="n">item_object</span><span class="o">.</span><span class="n">record_history_identity</span>
        <span class="n">child_items</span> <span class="o">=</span> <span class="n">schema</span><span class="p">[</span><span class="n">item_type</span><span class="p">]</span>
        <span class="n">child_level</span> <span class="o">=</span> <span class="n">level</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="c1"># Add the child items to the stack</span>
        <span class="k">if</span> <span class="s2">&quot;Part&quot;</span> <span class="ow">in</span> <span class="n">child_items</span><span class="p">:</span>
            <span class="n">items_to_process</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">p</span><span class="p">,</span> <span class="s2">&quot;Part&quot;</span><span class="p">,</span> <span class="n">child_level</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">item_object</span><span class="o">.</span><span class="n">parts</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;Specification&quot;</span> <span class="ow">in</span> <span class="n">child_items</span><span class="p">:</span>
            <span class="n">items_to_process</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;Specification&quot;</span><span class="p">,</span> <span class="n">child_level</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">item_object</span><span class="o">.</span><span class="n">specifications</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;Material&quot;</span> <span class="ow">in</span> <span class="n">child_items</span><span class="p">:</span>
            <span class="n">items_to_process</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Material&quot;</span><span class="p">,</span> <span class="n">child_level</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">item_object</span><span class="o">.</span><span class="n">materials</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;Coating&quot;</span> <span class="ow">in</span> <span class="n">child_items</span><span class="p">:</span>
            <span class="n">items_to_process</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;Coating&quot;</span><span class="p">,</span> <span class="n">child_level</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">item_object</span><span class="o">.</span><span class="n">coatings</span><span class="p">])</span>
        <span class="k">if</span> <span class="s2">&quot;Substance&quot;</span> <span class="ow">in</span> <span class="n">child_items</span><span class="p">:</span>
            <span class="n">items_to_process</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="n">s</span><span class="p">,</span> <span class="s2">&quot;Substance&quot;</span><span class="p">,</span> <span class="n">child_level</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">item_object</span><span class="o">.</span><span class="n">substances</span><span class="p">])</span>

    <span class="c1"># When the stack is empty, the while loop exists. Return the result list.</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
<p>Finally, call the preceding function against the results from the compliance query and use the list to create a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">flatten_bom</span><span class="p">(</span><span class="n">part_result</span><span class="o">.</span><span class="n">compliance_by_part_and_indicator</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">df_full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_full</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>
<span class="n">df_full</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
301 rows
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Item</th>
      <th>Parent</th>
      <th>Type</th>
      <th>SVHC</th>
      <th>Level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>565060</td>
      <td>None</td>
      <td>Part</td>
      <td>SVHC, WatchListHasSubstanceAboveThreshold</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>None</td>
      <td>565060</td>
      <td>Part</td>
      <td>SVHC, WatchListHasSubstanceAboveThreshold</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>None</td>
      <td>None</td>
      <td>Part</td>
      <td>SVHC, WatchListHasSubstanceAboveThreshold</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>None</td>
      <td>None</td>
      <td>Material</td>
      <td>SVHC, WatchListCompliant</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>None</td>
      <td>None</td>
      <td>Specification</td>
      <td>SVHC, WatchListHasSubstanceAboveThreshold</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Postprocess-the-pandas.DataFrame-object">
<h2>Postprocess the <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object<a class="headerlink" href="#Postprocess-the-pandas.DataFrame-object" title="Link to this heading">#</a></h2>
<p>Now that you have the data in a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object, you can perform operations across all levels of the structure more easily. For example, you can delete all rows that are less than the ‘Above Threshold’ state, retaining only rows that are non-compliant. (Note that this reduces the number of rows significantly.)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">threshold</span> <span class="o">=</span> <span class="n">indicators</span><span class="o">.</span><span class="n">WatchListFlag</span><span class="o">.</span><span class="n">WatchListAboveThreshold</span>
<span class="n">df_non_compliant</span> <span class="o">=</span> <span class="n">df_full</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df_full</span><span class="p">[</span><span class="n">df_full</span><span class="o">.</span><span class="n">SVHC</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_non_compliant</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>
<span class="n">df_non_compliant</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
18 rows
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Item</th>
      <th>Parent</th>
      <th>Type</th>
      <th>SVHC</th>
      <th>Level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>565060</td>
      <td>None</td>
      <td>Part</td>
      <td>SVHC, WatchListHasSubstanceAboveThreshold</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>None</td>
      <td>565060</td>
      <td>Part</td>
      <td>SVHC, WatchListHasSubstanceAboveThreshold</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>None</td>
      <td>None</td>
      <td>Part</td>
      <td>SVHC, WatchListHasSubstanceAboveThreshold</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>None</td>
      <td>None</td>
      <td>Specification</td>
      <td>SVHC, WatchListHasSubstanceAboveThreshold</td>
      <td>3</td>
    </tr>
    <tr>
      <th>5</th>
      <td>83146</td>
      <td>None</td>
      <td>Coating</td>
      <td>SVHC, WatchListHasSubstanceAboveThreshold</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="3-3_Database-specific_configuration.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Database-specific configuration options</p>
      </div>
    </a>
    <a class="right-next"
       href="3-5_Creating_a_Bill_of_Materials.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Creating a Bill of Materials from an external data source</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Perform-a-compliance-query">Perform a compliance query</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Flatten-the-hierarchical-data-structure">Flatten the hierarchical data structure</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Postprocess-the-pandas.DataFrame-object">Postprocess the <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
<!-- If there is no fix edit button function, use the PyData edit-this-button--></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/examples/3_Advanced_Topics/3-4_Writing_compliance_results_to_a_dataframe.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright (c) 2024 ANSYS, Inc. All rights reserved.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the
  <a href="https://sphinxdocs.ansys.com/version/stable/index.html"
    >Ansys Sphinx Theme</a
  >
  0.15.1. <br />Last updated on
  <span id="date"></span>
</p>
<script>
  var options = { day: "numeric", month: "long", year: "numeric" };
  var lastModifiedDate = new Date(document.lastModified);
  var date = lastModifiedDate.toLocaleDateString("en-US", options);
  document.getElementById("date").innerHTML = date;
</script></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>