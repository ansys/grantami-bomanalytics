
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Create a BoM from an external data source &#8212; PyGranta BoM Analytics 2.1.0.dev0</title>

  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=365ca57ee442770a23c6" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=365ca57ee442770a23c6" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/ansys_sphinx_theme.css?v=35e44410" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/dataframe.css?v=1a040689" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=365ca57ee442770a23c6"></script>
 
<link href="../../_static/css/breadcrumbs.css" rel="stylesheet" />

    <script src="../../_static/documentation_options.js?v=bc775645"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=49e1bf35"></script>
    <script src="../../_static/js/table.js?v=b64f5182"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/3_Advanced_Topics/3-5_Creating_a_Bill_of_Materials';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.14.3';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://bomanalytics.grantami.docs.pyansys.com/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'dev';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <script src="../../_static/js/add_blank.js?v=f2ece54a"></script>
    <link rel="icon" href="../../_static/ansys-favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Sustainability" href="../4_Sustainability/index.html" />
    <link rel="prev" title="Write compliance results to a pandas.DataFrame object" href="3-4_Writing_compliance_results_to_a_dataframe.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <link rel="canonical" href="https://bomanalytics.grantami.docs.pyansys.com/version/stable/examples/3_Advanced_Topics/3-5_Creating_a_Bill_of_Materials.html" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container"><!-- Debugging: html_theme_options =  -->

<!-- If there is no MiliSearch enabled, use the PyData search -->
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
   
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/pyansys-logo-black-cropped.png" class="logo__image only-light" alt="PyGranta BoM Analytics 2.1.0.dev0 - Home"/>
    <script>document.write(`<img src="../../_static/pyansys-logo-black-cropped.png" class="logo__image only-dark" alt="PyGranta BoM Analytics 2.1.0.dev0 - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user_guide/index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../contributing.html">
                        Contribute
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/grantami-bomanalytics" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
    <div id="announcement_msg"></div>
<script>
  fetch("announcement.html")
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error: ${response.status}`);
      }
      return response.text();
    })
    .then(
      (text) => (document.getElementById("announcement_msg").innerHTML = text),
    )
    .catch((error) => console.error(`Fetch problem: ${error.message}`));
</script>  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../getting_started/index.html">
                        Getting started
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../user_guide/index.html">
                        User guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../api/index.html">
                        API reference
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../index.html">
                        Examples
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../contributing.html">
                        Contribute
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/grantami-bomanalytics" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../0_Getting_started.html">Basic usage example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1_Impacted_Substances_Queries/index.html">Impacted substances examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_Compliance_Queries/index.html">Compliance Examples</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Advanced examples</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="3-1_Working_with_XML_BoMs.html">Perform a BoM query</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-2_Dealing_with_external_data_sources.html">Determine compliance for BoMs in external data sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-3_Database-specific_configuration.html">Configure database-specific options</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-4_Writing_compliance_results_to_a_dataframe.html">Write compliance results to a <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> object</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Create a BoM from an external data source</a></li>

</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../4_Sustainability/index.html">Sustainability</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">
<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
         
    <li class="breadcrumb-item breadcrumb-home">
      <a href="https://docs.pyansys.com/" class="nav-link">PyAnsys</a>
    </li>
       
    <li class="breadcrumb-item">
      <a href="https://grantami.docs.pyansys.com/" class="nav-link">PyGranta</a>
    </li>
     
    <li class="breadcrumb-item">
      <a
        href="../../index.html"
        class="nav-link"
        aria-label="Home"
      >
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
     
    <li class="breadcrumb-item">
      <a href="../index.html" class="nav-link">Examples</a>
    </li>
     
    <li class="breadcrumb-item">
      <a href="index.html" class="nav-link">Advanced examples</a>
    </li>
      
    <li class="breadcrumb-item active" aria-current="page">Create a BoM from an external data source</li>
    
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p>Download this example as a <a class="reference download internal" download="" href="../../_downloads/87020889d67ef7c8a2a4901e0a5f5d53/3-5_Creating_a_Bill_of_Materials.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Jupyter</span> <span class="pre">notebook</span></code></a> or a
<a class="reference download internal" download="" href="../../_downloads/cfe63c6b671c6a17d1726d1afc0fe8a4/3-5_Creating_a_Bill_of_Materials.py"><code class="xref download docutils literal notranslate"><span class="pre">Python</span> <span class="pre">script</span></code></a>.</p>
<hr class="docutils" />
<section id="Create-a-BoM-from-an-external-data-source">
<h1>Create a BoM from an external data source<a class="headerlink" href="#Create-a-BoM-from-an-external-data-source" title="Link to this heading">#</a></h1>
<p>This example shows how to use the <code class="docutils literal notranslate"><span class="pre">bom_types</span></code> subpackage to create a valid Granta MI XML BoM. This subpackage can be used to help construct a Granta 23/01-compliant XML BoM file to use with the BoM queries provided by this package. The code in this example shows how to generate a BoM from a representative JSON data source. The general approach can be applied to data in other formats or provided by other APIs.</p>
<p>You can download the <a class="reference external" href="supporting-files/source_data_sustainability.json">external data source</a> used in this example.</p>
<p>The result of this example is a Granta 23/01-compliant XML BoM file that is suitable for sustainability analysis with the Granta MI BoM Analytics API. For more information on the expected content of XML BoMs, see the Granta MI documentation.</p>
<section id="Load-the-external-data">
<h2>Load the external data<a class="headerlink" href="#Load-the-external-data" title="Link to this heading">#</a></h2>
<p>First load the JSON file and use the <code class="docutils literal notranslate"><span class="pre">json</span></code> module, which converts the text into a hierarchical structure of <code class="docutils literal notranslate"><span class="pre">dict</span></code> and <code class="docutils literal notranslate"><span class="pre">list</span></code> objects.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;supporting-files/source_data_sustainability.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[{&#39;part_identifier&#39;: &#39;Part1[ProductAssembly]&#39;, &#39;type&#39;: &#39;Product&#39;},
 {&#39;parent_part_identifier&#39;: &#39;Part1[ProductAssembly]&#39;,
  &#39;part_identifier&#39;: &#39;Part1.1[SubAssembly]&#39;,
  &#39;quantity_in_parent&#39;: 1.0,
  &#39;type&#39;: &#39;Assembly&#39;},
 {&#39;parent_part_identifier&#39;: &#39;Part1.1[SubAssembly]&#39;,
  &#39;part_identifier&#39;: &#39;Part1.1.A[LeafPart]&#39;,
  &#39;part_mass_in_kg&#39;: 0.925,
  &#39;quantity_in_parent&#39;: 1.0,
  &#39;type&#39;: &#39;Part&#39;}]
</pre></div></div>
</div>
</section>
<section id="Inspect-the-external-data">
<h2>Inspect the external data<a class="headerlink" href="#Inspect-the-external-data" title="Link to this heading">#</a></h2>
<p>The external data source defines a flat list of items. Each item has at least the following:</p>
<ul class="simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">type</span></code> field that identifies the type of the item.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">parent_part_identifier</span></code> field that identifies the parent part in the hierarchy.</p></li>
</ul>
<p>Because items that refer to components do not have an equivalent record in Granta MI, they contain only the preceding fields and quantity and mass fields.</p>
<p>Items that refer to materials, processes, and transport stages correspond to records in Granta MI that contain the relevant sustainability metrics for these items. As a result, these items contain both a human-readable <code class="docutils literal notranslate"><span class="pre">name</span></code> field and a <code class="docutils literal notranslate"><span class="pre">Granta_MI_Record_GUID</span></code> field. In this scenario, the system that provided the data source contains the direct material assignments from Granta MI.</p>
<section id="Components">
<h3>Components<a class="headerlink" href="#Components" title="Link to this heading">#</a></h3>
<p>The external data source defines three different types of component:</p>
<ul class="simple">
<li><p>A single item of type <code class="docutils literal notranslate"><span class="pre">Product</span></code>. The external data source describes the BoM for this product. All other items are expected to be children of this item.</p></li>
<li><p>Items of type <code class="docutils literal notranslate"><span class="pre">Assembly</span></code>.</p></li>
<li><p>Items of type <code class="docutils literal notranslate"><span class="pre">Part</span></code>.</p></li>
</ul>
<p>Extract the items into separate lists based on the <code class="docutils literal notranslate"><span class="pre">type</span></code> field. The <code class="docutils literal notranslate"><span class="pre">Product</span></code> item is stored in a variable directly because there can only be one product per BoM by definition.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_product</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Product&quot;</span><span class="p">)</span>
<span class="n">source_product</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;type&#39;: &#39;Product&#39;, &#39;part_identifier&#39;: &#39;Part1[ProductAssembly]&#39;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_assemblies</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Assembly&quot;</span><span class="p">]</span>
<span class="n">source_assemblies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;type&#39;: &#39;Assembly&#39;,
 &#39;parent_part_identifier&#39;: &#39;Part1[ProductAssembly]&#39;,
 &#39;part_identifier&#39;: &#39;Part1.1[SubAssembly]&#39;,
 &#39;quantity_in_parent&#39;: 1.0}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Part&quot;</span><span class="p">]</span>
<span class="n">source_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;type&#39;: &#39;Part&#39;,
 &#39;parent_part_identifier&#39;: &#39;Part1.1[SubAssembly]&#39;,
 &#39;part_identifier&#39;: &#39;Part1.1.A[LeafPart]&#39;,
 &#39;quantity_in_parent&#39;: 1.0,
 &#39;part_mass_in_kg&#39;: 0.925}
</pre></div></div>
</div>
</section>
<section id="Materials">
<h3>Materials<a class="headerlink" href="#Materials" title="Link to this heading">#</a></h3>
<p>Because the third-party system only allows assignment of a single material per part, there is no ‘quantity’ associated with the material. It is assumed that the part is made entirely of the referenced material.</p>
<p>Extract the material items into a list based on the <code class="docutils literal notranslate"><span class="pre">type</span></code> field.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_materials</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Material&quot;</span><span class="p">]</span>
<span class="n">source_materials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;type&#39;: &#39;Material&#39;,
 &#39;parent_part_identifier&#39;: &#39;Part1.1.A[LeafPart]&#39;,
 &#39;name&#39;: &#39;stainless-astm-cn-7ms-cast&#39;,
 &#39;Granta_MI_Record_GUID&#39;: &#39;2086f56a-4f4d-4850-9891-3d6ad155d1f9&#39;}
</pre></div></div>
</div>
</section>
<section id="Processes">
<h3>Processes<a class="headerlink" href="#Processes" title="Link to this heading">#</a></h3>
<p>The external data source defines three different types of process:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MaterialFormingStep</span></code> items describe a process that forms a mass of material into a shaped component. In this scenario, the third-party system defines a single forming process for each part. These processes are mapped to <code class="docutils literal notranslate"><span class="pre">Primary</span> <span class="pre">processes</span></code> in the Granta MI BoM.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MaterialProcessingStep</span></code> items describe extra processing steps applied after the main forming processing step. These items include <code class="docutils literal notranslate"><span class="pre">step_order</span></code> and <code class="docutils literal notranslate"><span class="pre">mass_removed_in_kg</span></code> fields, which together fully describe the material removal. These processes are mapped to <code class="docutils literal notranslate"><span class="pre">Secondary</span> <span class="pre">processes</span></code> in the Granta MI BoM.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PartProcessingStep</span></code> items describe processes applied directly to parts. These processes are mapped to <code class="docutils literal notranslate"><span class="pre">Joining</span> <span class="pre">&amp;</span> <span class="pre">Finishing</span> <span class="pre">processes</span></code> in the Granta MI BoM.</p></li>
</ul>
<p>Extract the process items into lists based on their <code class="docutils literal notranslate"><span class="pre">type</span></code> fields.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_primary_processes</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MaterialFormingStep&quot;</span><span class="p">]</span>
<span class="n">source_primary_processes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;type&#39;: &#39;MaterialFormingStep&#39;,
 &#39;name&#39;: &#39;Primary processing, Casting&#39;,
 &#39;parent_part_identifier&#39;: &#39;Part1.1.A[LeafPart]&#39;,
 &#39;Granta_MI_Record_GUID&#39;: &#39;baa6c95b-ff0e-4811-9120-92717ee15bda&#39;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_secondary_processes</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;MaterialProcessingStep&quot;</span><span class="p">]</span>
<span class="n">source_secondary_processes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;type&#39;: &#39;MaterialProcessingStep&#39;,
 &#39;name&#39;: &#39;Machining, coarse&#39;,
 &#39;parent_part_identifier&#39;: &#39;Part1.1.A[LeafPart]&#39;,
 &#39;Granta_MI_Record_GUID&#39;: &#39;907bda29-e800-44f6-b7ea-4eb8e7cff375&#39;,
 &#39;step_order&#39;: 0,
 &#39;mass_removed_in_kg&#39;: 0.0808}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_joining_processes</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PartProcessingStep&quot;</span><span class="p">]</span>
<span class="n">source_joining_processes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;type&#39;: &#39;PartProcessingStep&#39;,
 &#39;name&#39;: &#39;Joining and finishing, Welding, electric&#39;,
 &#39;parent_part_identifier&#39;: &#39;Part1.1[SubAssembly]&#39;,
 &#39;Granta_MI_Record_GUID&#39;: &#39;21941b5e-fdbc-47fe-8180-809bb42e5e0a&#39;,
 &#39;step_order&#39;: 0,
 &#39;quantity&#39;: 0.45,
 &#39;quantity_unit&#39;: &#39;m&#39;}
</pre></div></div>
</div>
</section>
<section id="Transports">
<h3>Transports<a class="headerlink" href="#Transports" title="Link to this heading">#</a></h3>
<p>The external data source defines transport stages. These items of type <code class="docutils literal notranslate"><span class="pre">Transport</span></code> contain a <code class="docutils literal notranslate"><span class="pre">distance_in_km</span></code> field that contains the distance covered by the transport step.</p>
<p>Extract the transport items into a list based on their <code class="docutils literal notranslate"><span class="pre">type</span></code> fields.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_transports</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Transport&quot;</span><span class="p">]</span>
<span class="n">source_transports</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;type&#39;: &#39;Transport&#39;,
 &#39;name&#39;: &#39;Port to airport by truck&#39;,
 &#39;Granta_MI_Record_GUID&#39;: &#39;8d37ee4c-41ca-4cb5-9e8e-264646fcafa8&#39;,
 &#39;distance_in_km&#39;: 350.0}
</pre></div></div>
</div>
</section>
</section>
<section id="Build-the-BillOfMaterials-object">
<h2>Build the <code class="docutils literal notranslate"><span class="pre">BillOfMaterials</span></code> object<a class="headerlink" href="#Build-the-BillOfMaterials-object" title="Link to this heading">#</a></h2>
<p>The PyGranta BoM Analytics package provides the <code class="docutils literal notranslate"><span class="pre">bom_types</span></code> subpackage, which implements serialization and deserialization between the Granta 23/01 BoM XML schema and Python objects. This section shows how data from the external data source is processed to create BoM Python objects, which can then be serialized to an XML BoM.</p>
<p>If you are using a customized database, before running any queries, change the database key value in the following cell and see the <a class="reference internal" href="3-3_Database-specific_configuration.html"><span class="doc">Database specific configuration</span></a> example to appropriately configure the connection.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansys.grantami.bomanalytics</span> <span class="kn">import</span> <span class="n">bom_types</span>
<span class="n">DB_KEY</span> <span class="o">=</span> <span class="s2">&quot;MI_Restricted_Substances&quot;</span>
</pre></div>
</div>
</div>
<section id="id1">
<h3>Components<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>The external system defines a <code class="docutils literal notranslate"><span class="pre">part_identifier</span></code> field that uniquely identifies parts. However, the Granta MI BoM schema requires a part to define a <code class="docutils literal notranslate"><span class="pre">Part</span> <span class="pre">number</span></code>. Use the external <code class="docutils literal notranslate"><span class="pre">part_identifier</span></code> as a part number.</p>
<p>First, create a <code class="docutils literal notranslate"><span class="pre">bom_types.Part</span></code> object for every item that maps to a BoM part and add it to a dictionary indexed by the part number. This allows you to identify the correct parent part when adding materials and processes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">components</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Product</span>
<span class="n">product_id</span> <span class="o">=</span> <span class="n">source_product</span><span class="p">[</span><span class="s2">&quot;part_identifier&quot;</span><span class="p">]</span>
<span class="n">components</span><span class="p">[</span><span class="n">product_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">bom_types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span>
    <span class="n">part_number</span><span class="o">=</span><span class="n">product_id</span><span class="p">,</span>
    <span class="n">quantity</span><span class="o">=</span><span class="n">bom_types</span><span class="o">.</span><span class="n">UnittedValue</span><span class="p">(</span>
        <span class="n">value</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Each&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Assemblies</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">source_assemblies</span><span class="p">:</span>
    <span class="n">item_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;part_identifier&quot;</span><span class="p">]</span>
    <span class="n">components</span><span class="p">[</span><span class="n">item_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">bom_types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="n">item_id</span><span class="p">,</span>
        <span class="n">quantity</span><span class="o">=</span><span class="n">bom_types</span><span class="o">.</span><span class="n">UnittedValue</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;quantity_in_parent&quot;</span><span class="p">],</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Each&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># Parts</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">source_parts</span><span class="p">:</span>
    <span class="n">item_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;part_identifier&quot;</span><span class="p">]</span>
    <span class="n">components</span><span class="p">[</span><span class="n">item_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">bom_types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span>
        <span class="n">part_number</span><span class="o">=</span><span class="n">item_id</span><span class="p">,</span>
        <span class="n">quantity</span><span class="o">=</span><span class="n">bom_types</span><span class="o">.</span><span class="n">UnittedValue</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;quantity_in_parent&quot;</span><span class="p">],</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;Each&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">mass_per_unit_of_measure</span><span class="o">=</span><span class="n">bom_types</span><span class="o">.</span><span class="n">UnittedValue</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;part_mass_in_kg&quot;</span><span class="p">],</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;kg/Each&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The components dict contains </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span><span class="si">}</span><span class="s2"> items.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The components dict contains 8 items.
</pre></div></div>
</div>
<p>Next, define the hierarchy. The external data source defines a hierarchy by reference (for example, the child part contains the identity of the parent part), but the Granta MI BoM represents the hierarchy using the BoM structure (for example, a parent part contains all child parts as properties on the parent).</p>
<p>The following cell iterates over all source parts and assemblies again and appends child parts to their parents’ <code class="docutils literal notranslate"><span class="pre">components</span></code> property.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">source_assemblies</span> <span class="o">+</span> <span class="n">source_parts</span><span class="p">:</span>
    <span class="n">item_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;part_identifier&quot;</span><span class="p">]</span>
    <span class="n">parent_item_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;parent_part_identifier&quot;</span><span class="p">]</span>
    <span class="n">item_bom_definition</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="n">item_id</span><span class="p">]</span>
    <span class="n">parent_item_bom_definition</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="n">parent_item_id</span><span class="p">]</span>
    <span class="n">parent_item_bom_definition</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_bom_definition</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="id2">
<h3>Materials<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>Next, create <code class="docutils literal notranslate"><span class="pre">bom_types.Material</span></code> objects for each material and add the materials to their parent part object.</p>
<p>There are multiple possible ways of identifying Granta MI records in the BoM. In this example, the external data source holds references to Granta MI records by record GUIDs, and so the GUIDs are used to instantiate the required <code class="docutils literal notranslate"><span class="pre">MIRecordReference</span></code> objects.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_record_reference</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">db_key</span><span class="o">=</span><span class="n">DB_KEY</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">bom_types</span><span class="o">.</span><span class="n">MIRecordReference</span><span class="p">(</span>
        <span class="n">db_key</span><span class="o">=</span><span class="n">db_key</span><span class="p">,</span>
        <span class="n">record_guid</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;Granta_MI_Record_GUID&quot;</span><span class="p">]</span>
    <span class="p">)</span>


<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">source_materials</span><span class="p">:</span>
    <span class="n">parent_part_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;parent_part_identifier&quot;</span><span class="p">]</span>
    <span class="n">material</span> <span class="o">=</span> <span class="n">bom_types</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span>
        <span class="n">mi_material_reference</span><span class="o">=</span><span class="n">make_record_reference</span><span class="p">(</span><span class="n">item</span><span class="p">),</span>
        <span class="n">identity</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
        <span class="n">percentage</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">components</span><span class="p">[</span><span class="n">parent_part_id</span><span class="p">]</span><span class="o">.</span><span class="n">materials</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">material</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="id3">
<h3>Processes<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>In general, the order in which processes are applied is significant and can affect the result. To ensure consistency, the external system defines a <code class="docutils literal notranslate"><span class="pre">step_order</span></code> field, which represents the order in which processes are applied to the parent part or material. The cells in this section first sort the processes by <code class="docutils literal notranslate"><span class="pre">step_order</span></code> to ensure that they are added to the BoM correctly.</p>
<p>First, apply primary and secondary processes to materials. In the external data source, the parent of a process item is always the parent part, but sustainability analysis expects only a single material assigned to each part. As a result, the process can be moved from the part to the material when constructing the Granta BoM.</p>
<p><code class="docutils literal notranslate"><span class="pre">MaterialFormingStep</span></code> processes from the external data source are all mapped to <code class="docutils literal notranslate"><span class="pre">Process</span></code> with a <code class="docutils literal notranslate"><span class="pre">Mass</span></code> dimension type. This is the default value for processes whose environmental impact is calculated based on the mass of material that goes through the process. This mass is calculated from the final mass of the part and mass removed during additional processing steps. For more information on mass calculations, see the Granta MI documentation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">source_primary_processes</span><span class="p">:</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">bom_types</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span>
        <span class="n">mi_process_reference</span><span class="o">=</span><span class="n">make_record_reference</span><span class="p">(</span><span class="n">item</span><span class="p">),</span>
        <span class="n">identity</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
        <span class="n">dimension_type</span><span class="o">=</span><span class="n">bom_types</span><span class="o">.</span><span class="n">DimensionType</span><span class="o">.</span><span class="n">Mass</span><span class="p">,</span>
        <span class="n">percentage</span><span class="o">=</span><span class="mf">100.0</span>
    <span class="p">)</span>
    <span class="c1"># Use the parent part identifier to retrieve the part created earlier</span>
    <span class="n">parent_part_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;parent_part_identifier&quot;</span><span class="p">]</span>
    <span class="c1"># Append the process to the part via the assigned material</span>
    <span class="n">components</span><span class="p">[</span><span class="n">parent_part_id</span><span class="p">]</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Next, apply secondary processes to materials. These are added sequentially to the list of processes on the material object, in the same order as defined by the <code class="docutils literal notranslate"><span class="pre">step_order</span></code> field.</p>
<p><code class="docutils literal notranslate"><span class="pre">MaterialProcessingStep</span></code> processes from the external data source are mapped to <code class="docutils literal notranslate"><span class="pre">Process</span></code> with a <code class="docutils literal notranslate"><span class="pre">MassRemoved</span></code> dimension type. For these processes, the environmental impact is calculated based on the mass of material removed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sort the list of secondary processes by the ``step_order`` field.</span>
<span class="n">source_secondary_processes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;parent_part_identifier&quot;</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;step_order&quot;</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">source_secondary_processes</span><span class="p">:</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">bom_types</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span>
        <span class="n">mi_process_reference</span><span class="o">=</span><span class="n">make_record_reference</span><span class="p">(</span><span class="n">item</span><span class="p">),</span>
        <span class="n">identity</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
        <span class="n">dimension_type</span><span class="o">=</span><span class="n">bom_types</span><span class="o">.</span><span class="n">DimensionType</span><span class="o">.</span><span class="n">MassRemoved</span><span class="p">,</span>
        <span class="n">quantity</span><span class="o">=</span><span class="n">bom_types</span><span class="o">.</span><span class="n">UnittedValue</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;mass_removed_in_kg&quot;</span><span class="p">],</span>
            <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">parent_part_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;parent_part_identifier&quot;</span><span class="p">]</span>
    <span class="n">components</span><span class="p">[</span><span class="n">parent_part_id</span><span class="p">]</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Finally, apply joining and finishing processes to the part.</p>
<p>The example external data only includes part processes characterized by the length dimension. However, the Granta MI BoM schema has support for different <code class="docutils literal notranslate"><span class="pre">DimensionType</span></code> values depending on the process. For example, welding is typically defined by a welding path length, but a coating operation would be best quantified by an area.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unit_to_dimension_type</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="n">bom_types</span><span class="o">.</span><span class="n">DimensionType</span><span class="o">.</span><span class="n">Length</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">source_joining_processes</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;parent_part_identifier&quot;</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;step_order&quot;</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">source_joining_processes</span><span class="p">:</span>
    <span class="n">process</span> <span class="o">=</span> <span class="n">bom_types</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span>
        <span class="n">mi_process_reference</span><span class="o">=</span><span class="n">make_record_reference</span><span class="p">(</span><span class="n">item</span><span class="p">),</span>
        <span class="n">identity</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
        <span class="c1"># Map the unit in the input file to the DimensionType enum.</span>
        <span class="n">dimension_type</span><span class="o">=</span><span class="n">unit_to_dimension_type</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;quantity_unit&quot;</span><span class="p">]],</span>
        <span class="n">quantity</span><span class="o">=</span><span class="n">bom_types</span><span class="o">.</span><span class="n">UnittedValue</span><span class="p">(</span>
            <span class="n">value</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;quantity&quot;</span><span class="p">],</span>
            <span class="n">unit</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;quantity_unit&quot;</span><span class="p">]</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parent_part_id</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;parent_part_identifier&quot;</span><span class="p">]</span>
    <span class="n">components</span><span class="p">[</span><span class="n">parent_part_id</span><span class="p">]</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="BillOfMaterials-object">
<h3><code class="docutils literal notranslate"><span class="pre">BillOfMaterials</span></code> object<a class="headerlink" href="#BillOfMaterials-object" title="Link to this heading">#</a></h3>
<p>The original root part can now be retrieved from the <code class="docutils literal notranslate"><span class="pre">components</span></code> dictionary. This <code class="docutils literal notranslate"><span class="pre">Part</span></code> item contains the entire structure of parts, materials, and process objects. The following cell extracts this component from the dictionary of all components, deletes the dictionary, and prints an arbitrary property of the root component to illustrate this structure.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root_component</span> <span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="n">source_product</span><span class="p">[</span><span class="s2">&quot;part_identifier&quot;</span><span class="p">]]</span>
<span class="k">del</span> <span class="n">components</span>
<span class="nb">print</span><span class="p">(</span><span class="n">root_component</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">materials</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">processes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">identity</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Machining, fine
</pre></div></div>
</div>
<p>The final step is to create a <code class="docutils literal notranslate"><span class="pre">BillOfMaterials</span></code> object and add the root component and transport stages. Note that the transport stages are added to the <code class="docutils literal notranslate"><span class="pre">BillOfMaterials</span></code> object itself, not to a specific component.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bom</span> <span class="o">=</span> <span class="n">bom_types</span><span class="o">.</span><span class="n">BillOfMaterials</span><span class="p">(</span><span class="n">components</span><span class="o">=</span><span class="p">[</span><span class="n">root_component</span><span class="p">])</span>

<span class="n">transports</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">bom_types</span><span class="o">.</span><span class="n">TransportStage</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
        <span class="n">mi_transport_reference</span><span class="o">=</span><span class="n">make_record_reference</span><span class="p">(</span><span class="n">item</span><span class="p">),</span>
        <span class="n">distance</span><span class="o">=</span><span class="n">bom_types</span><span class="o">.</span><span class="n">UnittedValue</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">&quot;distance_in_km&quot;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;km&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">source_transports</span>
<span class="p">]</span>
<span class="n">bom</span><span class="o">.</span><span class="n">transport_phase</span> <span class="o">=</span> <span class="n">transports</span>
</pre></div>
</div>
</div>
</section>
</section>
</section>
<section id="Serialize-the-BoM">
<h1>Serialize the BoM<a class="headerlink" href="#Serialize-the-BoM" title="Link to this heading">#</a></h1>
<p>Use the <code class="docutils literal notranslate"><span class="pre">BomHandler</span></code> helper class to serialize the object to XML. The resulting string can be used in a sustainability query. For more information, see the <a class="reference internal" href="../4_Sustainability/index.html"><span class="doc">Sustainability examples</span></a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ansys.grantami.bomanalytics</span> <span class="kn">import</span> <span class="n">BoMHandler</span>
<span class="n">bom_as_xml</span> <span class="o">=</span> <span class="n">BoMHandler</span><span class="p">()</span><span class="o">.</span><span class="n">dump_bom</span><span class="p">(</span><span class="n">bom</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bom_as_xml</span><span class="p">[:</span><span class="mi">500</span><span class="p">]</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;ns0:PartsEco xmlns:ns0=&#34;http://www.grantadesign.com/23/01/BillOfMaterialsEco&#34; xmlns:ns1=&#34;http://www.grantadesign.com/12/05/GrantaBaseTypes&#34;&gt;
    &lt;ns0:Components&gt;
        &lt;ns0:Part&gt;
            &lt;ns0:Quantity Unit=&#34;Each&#34;&gt;1.0&lt;/ns0:Quantity&gt;
            &lt;ns0:PartNumber&gt;Part1[ProductAssembly]&lt;/ns0:PartNumber&gt;
            &lt;ns0:Components&gt;
                &lt;ns0:Part&gt;
                    &lt;ns0:Quantity Unit=&#34;Each&#34;&gt;1.0&lt;/ns0:Quantity&gt;
                    &lt;ns0:PartNumber&gt;Part1.1[SubAssembly]&lt;/ns0:PartNumber...
</pre></div></div>
</div>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Create a BoM from an external data source</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Load-the-external-data">Load the external data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Inspect-the-external-data">Inspect the external data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Components">Components</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Materials">Materials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Processes">Processes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Transports">Transports</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Build-the-BillOfMaterials-object">Build the <code class="docutils literal notranslate"><span class="pre">BillOfMaterials</span></code> object</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Components</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Materials</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Processes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#BillOfMaterials-object"><code class="docutils literal notranslate"><span class="pre">BillOfMaterials</span></code> object</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#Serialize-the-BoM">Serialize the BoM</a></li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">
<!-- If there is no fix edit button function, use the PyData edit-this-button--></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="../../_sources/examples/3_Advanced_Topics/3-5_Creating_a_Bill_of_Materials.ipynb.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=365ca57ee442770a23c6"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=365ca57ee442770a23c6"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright (c) 2024 ANSYS, Inc. All rights reserved.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the
  <a href="https://sphinxdocs.ansys.com/version/stable/index.html"
    >Ansys Sphinx Theme</a
  >
  0.15.2. <br />Last updated on
  <span id="date"></span>
</p>
<script>
  var options = { day: "numeric", month: "long", year: "numeric" };
  var lastModifiedDate = new Date(document.lastModified);
  var date = lastModifiedDate.toLocaleDateString("en-US", options);
  document.getElementById("date").innerHTML = date;
</script></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>